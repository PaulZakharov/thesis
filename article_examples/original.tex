\documentclass[a4paper,12pt,oneside]{scrartcl}

% Setup page
\usepackage[top=2.0cm, bottom=2.0cm, left=3cm, right=1.5cm, footskip=0.5cm]{geometry}
\usepackage{epsfig}
\usepackage{xcolor}

% Base packages
\usepackage{fontspec}
\usepackage{booktabs}
\usepackage{xunicode}
\usepackage{xltxtra}
\usepackage{comment}
\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage{longtable}
\usepackage{csquotes}
\usepackage{setspace}
\usepackage{placeins}
\usepackage{float}
\setcounter{tocdepth}{4}
\setcounter{secnumdepth}{4}
% Setup Russian hyphenation
\usepackage{polyglossia}
\setdefaultlanguage[spelling=modern]{russian} % for polyglossia
\setotherlanguage{english} % for polyglossia
\defaultfontfeatures{Scale=MatchLowercase, Mapping=tex-text}

% Setup fonts
\newfontfamily\russianfont{CMU Serif}
\newfontfamily\cyrillicfont{CMU Serif}
\setromanfont{CMU Serif}
\setsansfont{CMU Sans Serif}
\setmonofont{CMU Typewriter Text}


% Be able to include PNG and PDF as images
\usepackage{graphicx}
\usepackage{subcaption}

% Be able to insert hyperlinks
\usepackage{hyperref}
\hypersetup{colorlinks=true, linkcolor=black, filecolor=black, citecolor=black, urlcolor=black , pdfauthor=Grigory Rechistov <grigory.rechistov@phystech.edu>, pdftitle=Шаблон для написания диплома в LaTeX}
\usepackage{url}

% Misc optional packages
\usepackage{footnpag}
\usepackage{indentfirst}
\usepackage{underscore}
\usepackage{amsthm}
\usepackage{enumitem} % continue enumeration 
\usepackage{mdwlist} % compact itemize lists environment
\usepackage{mdwlist} % compact itemize lists environment
%\renewcommand{\labelitemi}{--}  % Use endash for itemized lists
\usepackage[hang,flushmargin]{footmisc} % correct indent for footnotes


% Attach TikZ/PGF system to be able to draw vector plots.
% \usepackage{tikz}
% \usetikzlibrary{shapes, calc, arrows, fit, positioning, decorations, patterns, decorations.pathreplacing,chains, snakes}

% A new command to mark not done places
\newcommand{\todo}[1][Напиши меня]{{\color{red}TODO\ #1}}
\onehalfspacing
\begin{document}

\input{titlepage}
\cleardoublepage


\tableofcontents
\listoffigures
\listoftables

\cleardoublepage

\section{Введение}
В ближайшем будущем сотни миллионов полупроводниковых сенсоров будут  являться неотъемлемой частью нашего мира. Датчики будут интегрироваться во все, что только возможно: бытовую технику, автомобили, детские коляски и многое другое. Все они будут в состоянии не только выступать в роли сенсоров, но и выполнять первичную обработку информации, а также взаимодействовать друг с другом, образуя единую беспроводную сенсорную сеть. Главной особенностью этих сенсоров является их низкое энергопотребление. Это необходимо для того, чтобы датчики могли работать автономно, и их встроенных аккумуляторов хватало на несколько лет, то есть на весь срок работы сенсоров.  Датчики объединяют в единую сеть – беспроводная сенсорная сеть или Wireless Sensor Networks~\cite{B1}.

Беспроводные сенсорные сети - это новая эпоха в развитии технологий. Если данную сеть разместить в лесу,больше бы не было пожаров, ведь сенсоры будут следить за состоянием каждого участка леса. Аналогичноданную сеть можно использовать в сельскохозяйственной отрасли, чтобы контролировать состояние почвы ивыращиваемой культуре.

Для того чтобы воплотить эту мечту в реальность, необходимо создать устройство, способное считыватьинформацию с датчиков, при этом потреблять мало энергии, и способной передавать данные намикроконтроллер. Для данной задачи идеально подходит преобразователь напряжения в частоту (ПНЧ).
Рассмотрим теперь два типа схем, предназначенных для использования в сенсорных сетях
(Рис.~\ref{fig:WSN}).

\begin{figure}[!htb]
    \centering
    \includegraphics[width=0.6\textwidth]{pics/pic1.png}
    \caption{Узел БСС с использованием: a) АЦП (ADC) б) ПНЧ (VFC)}
    \label{fig:WSN}
\end{figure}
Рассмотрим работу данного узла. Датчики (sensor i), выходные напряжения которых зависят от того что они измеряют, подают на мультиплексор определенное значение напряжения, далее микроконтроллер посылает на мультиплексор управляющий сигнал, для того чтобы выбрать показания какого датчика мы будем снимать. Далее сигнал усиливается на программируемом усилителе напряжения(PVA) и подается на ПНЧ или АЦП. Далее на микроконтроллер приходит цифровой сигнал и обрабатывается.

Преимущества реализации схемы узла БСС, в котором используется ПНЧ (рис.2a), над схемой в которойиспользуется АЦП (рис.1a) заключаются в следующем:
\begin{enumerate}
    \item ПНЧ обладает большей устойчивостью к шумам, интегрируя их.
    \item ПНЧ потребляет меньше энергии.
\end{enumerate}
Благодаря данным преимуществам большинство схем узлов создаются на базе преобразователя напряжения вчастоту.

Беспроводные сенсорные сети - это будущее к которому мы плавно подходим, но существует также класссистем, для которых тоже эффективно использование ПНЧ - телеметрия. У ПНЧ есть характерная особенность,которой нету у обычных АЦП, что делает его востребованным в приложениях, связанных с телеметрией:отсутствие потери информации. ПНЧ непрерывно следит за сигналом, интегрирует шум и уменьшает ошибку стечением времени, а не накапливает ее, как, к примеру, это происходит в АЦП последовательного приближения. 

В телеметрических системах необходимо непрерывно следить за сигналом и не терять информацию, котораянеобходима для корректировки траектории полета ракеты, движения автомобиля и тд. Подключив ПНЧ какселерометру + гироскопу, мы сможем получать данные изменения траектории по трем координатам (x, y,z), и подавать эту информацию на микроконтроллер для того, чтобы он смог скорректировать движение. Дляэтого нужно создать многоканальный ПНЧ, способный непрерывно следить сразу за тремя выходамиакселерометра (координаты x, y, z), и обрабатывать большой диапазон напряжений, как положительных, таки отрицательных. Для использования в этих применениях целесообразно также отслеживать информацию поусловиям эксплуатации (температуре напряжению питания, опорному напряжению), которая можетиспользоваться для компенсации погрешностей, как самих ПНЧ, так и датчиков входных сигналов, работающихв этих условиях.~\cite{B2}
\clearpage












\section{Обзор литературы}




\subsection{Разновидности архитектур ПНЧ}

Известны  два типа ПНЧ: на основе мультивибратора (multivibrator) и балансирующие (charge-balance). В свою очередь балансирующие ПНЧ делятся на синхронные и асинхронные. Рассмотрим эти типы ПНЧ.








\subsubsection{ПНЧ на основе мультивибратора}

Структурная схема ПНЧ, основанного на мультивибраторе, показана на рисунке~\ref{fig:Mult}a, а ее реализация показана на рисунке~\ref{fig:Mult}b. Данный тип ПНЧ состоит из входного преобразователя напряжения в ток, за которым следует двунаправленный интегратор тока, управляемый специальной схемой. 

\begin{figure}[!htb]
    \centering
    \includegraphics[width=0.7\textwidth]{pics/mult.png}
    \caption{ПНЧ на основе мультивибратора: (a)структурная схема, (b)архитектура, (с)выходные сигналы интегратора и ПНЧ}
    \label{fig:Mult}
\end{figure}

Принцип работы заключается в следующем. Входное напряжение Vin линейно преобразуется в ток Iin. Этот ток заряжает и разряжает интегрирующий конденсатор Cint между двумя предельными напряжениями VH и VL, определяемыми схемой управления, которая обычно представляет собой компаратор напряжения или триггер Шмитта. Форма выходного сигнала интегратора имеет пилообразную форму, а выход схемы управления представляет собой прямоугольный сигнал (рис.~\ref{fig:Mult}c), который является выходной частотой f0 ПНЧ. Выходная частота управляет ключом, который контролирует заряд и разряд конденсатора Cint.

Зависимость частоты  от входного напряжения может быть выражена следующей формулой:
$$F_{out} = \frac{1}{2} I_{in} \frac{1}{C_{int}\Delta V}$$

Из данной формулы следует, что диапазон выходной частоты ПНЧ ограничивается: линейностью перевода Vin - Iin, шумом компаратора и температурным коэффициентом Cint. На практике ПНЧ такой архитектуры способны достигать до 12 бит линейности~\cite{B3}.








\subsubsection{Асинхронный балансирующий ПНЧ}
Теперь рассмотрим еще один тип ПНЧ - балансирующий. Существуют 2 класса данных схем асинхронные и синхронные. Рассмотрим первую из них. На рисунке~\ref{fig:Avfc}а представлена структурная схема асинхронного ПНЧ. Данная структура включает в себя преобразователь напряжения в ток (V-I converter), интегратор тока (current integrator), контроллер управления (control circuit) и источник опорного тока(reference current source)~\cite{B3}.

\begin{figure}[!htb]
    \centering
    \includegraphics[width=0.6\textwidth]{pics/AVFC.png}
    \caption{Асинхронный балансирующий ПНЧ: (a)структурная схема, (b)архитектура, (с)выходные сигналы интегратора и ПНЧ}
    \label{fig:Avfc}
\end{figure}

Реализация данной архитектуры представлена на рисунке~\ref{fig:Avfc}b. Сигнал, который приходит на вход Rin, преобразовывается в Iin и заряжает Cint. Когда напряжение на выходе интегратора доходит то уровня порогового уровня Vu, происходит переключение компаратора. При переключении, в виду наличия петли гистерезиса в компараторе, генерируется импульс, открывающий ключ контроля опорного тока. За это время опорный ток Iref, │Iref│> │Iin│, разряжает конденсатор Cint. Но при этом входной ток непрерывно течет во время разряда, поэтому мы не теряем часть информации о входном сигнале. Как показано на рисунке~\ref{fig:Avfc}с, форма выходного сигнала ПНЧ представляет собой прямоугольные импульсы, где время T1 - время заряда Сint (зависит от Vin), а T2 - время разряда конденсатора. 

Выведем формулу зависимости входного напряжения и выходной частоты:
$$F_{out} = \frac{1}{T_{1} + T_{2}} = \frac{I_{in}}{I_{ref}}\frac{1}{T_{2}}$$

Этот вид ПНЧ более сложный и потребляет намного больше, чем мультивибратор, но при этом способен достигать около 16 - 18 бит линейности. Критические параметры для данного ПНЧ являются: ширина импульса возврата (время открытия ключа) и значение опорного тока, который должен быть очень стабильным. На низких частотах стабильность источников напряжения Vref и Vu ставят под угрозу правильную работу VFC. На высоких частотах эффекты второго порядка, такие как переходные процессы в интеграторе влияют на точность и линейность.

Данный тип ПНЧ способен работать в диапазоне [-Vdd, +Vdd], при условии │Iref│>│Iin│и наличия отрицательного напряжения опоры Vref. 








\subsubsection{Синхронный балансирующий ПНЧ}

Итак, нам осталось рассмотреть последний тип ПНЧ - синхронный балансирующий. 
Такая реализация позволяет добиться до 18 бит линейности и высокой стабильности по температуре, что крайне необходимо для телеметрии (высокая точность) и космоса (стабильность по температуре). Структурная схема такого ПНЧ представлена на рисунке~\ref{fig:svfc}а. В таком типе преобразователей фаза разряда Cint наступает не сразу после переключения компаратора, а на следующем такте. Уравнение выходной частоты определяется следующей формулой:
$$F_{out} = \frac{I_{in}}{I_{ref}}f_{clk}$$
Из данного выражения видим, что выходная частота зависит от тактовой частоты.
Данная зависимость приводит к неравномерному распределению выходных импульсов. В отличие от ПНЧ, рассмотренных ранее, выходная частота содержит компоненты, гармонически связанные с тактовой частотой. Это является основной причиной путаницы при отображении выхода синхронного ПНЧ (СПНЧ) на осциллографе. В асинхронном ПНЧ увеличение входного напряжения приводит к увеличению выходной частоты, тогда как изменение напряжения в СПНЧ приводит к изменению плотности вероятности выходных N и N + 1 тактовых импульсов, что часто неверно интерпретируется как сильный джиттер. Данная проблема не повлияет на использование СПНЧ(синхронный преобразователь напряжения в частоту) как части АЦП, но данный тип преобразователей невозможно использовать в качестве генератора. Другой недостаток проявляется при близости выходной частоты к субгармоникам тактовой частоты. При выполнении данного условия может образованию небольшая мертвая зона в отклике компаратора.

Несмотря на эти недостатки, СПНЧ имеет лучшие характеристики в сравнении с АПНЧ, что делает его востребованным для устройств, для которых необходим преобразователь с высоким разрешением. 

Структурная схема синхронного ПНЧ отличается от структуры асинхронного ПНЧ только наличием тактового сигнала (CLK), подключаемого к контроллеру (control circuit).

\begin{figure}[!htb]
    \centering
    \includegraphics[width=0.7\textwidth]{pics/SVFC.png}
    \caption{Синхронный балансирующий ПНЧ: (a)структурная схема, (b)архитектура, (с)тактовый сигнал (CLK) и выходные сигналы интегратора и ПНЧ}
    \label{fig:svfc}
\end{figure}

Как и в случае с АПНЧ, входное напряжение Vin преобразуется в ток Iin, после чего интегрируется на конденсаторе Cint. Напряжение на конденсаторе сравнивается с пороговым напряжением Vu. Когда напряжение на конденсаторе достигает Vu, выход компаратора изменяется, но, в отличие от АПНЧ, управляющий сигнал для запуска в систему тока Iref не приходит до тех пор, пока не поступит следующий импульс синхронизации. Аналогично фаза заряда Cint будет продолжается до следующего тактового импульса. Как только ключ открывается, конденсатор начинает разряжаться в течение фиксированного времени (период тактового сигнала) (рис~\ref{fig:svfc}b,~\ref{fig:svfc}c).~\cite{B3}










\subsection{Операционный усилитель}

Операционный усилитель - это линейное устройство, которое обладают всеми свойствами, необходимыми для почти идеального усиления постоянного тока, и поэтому широко используются в формировании сигналов, фильтрации или для выполнения математических операций, таких как сложение, вычитание, интегрирование и дифференцирование.

ОУ предназначен для использования с внешней обратной связью, которая создается с помощью резисторов и конденсаторов, подключенных между его выходными и входными терминалами. Эти компоненты обратной связи определяют результирующую функцию или «работу» усилителя, и в силу различных конфигураций обратной связи, будь то резистивные, емкостные или и те, и другие, усилитель может выполнять множество различных операций. Именно поэтому этот тип усилителей называют операционными.

Операционный усилитель, обычно, представляет собой устройство, состоящее из инвертирующего (-) и неинвертирующего (+) высокоомных входов и выхода. 

В линейном операционном усилителе выходной сигнал равен входному сигналу, умноженному на коэффициент усиления (А). В зависимости от характера входных и выходных сигналов, операционные усилители можно разделить на четыре различных группы по типу усиления:
\begin{enumerate}
    \item Напряжение: вход-напряжение, выход-напряжение.
    \item Ток:  вход-ток, выход-ток.
    \item Крутизна: вход-напряжение, выход-ток.
    \item Сопротивление: вход-ток, выход-напряжение.
\end{enumerate}
	
Поскольку большинство схем, работающих с операционными усилителями, являются усилителями напряжения, мы ограничимся рассмотрением только первого типа (Vin и Vout).
Выходное напряжение операционного усилителя представляет собой разность входных напряжений, усиленных в A раз.
Схематично операционный усилитель изображен на рис.~\ref{fig:opa}. Здесь V1 и V2 - входные сигналы: V1 подается на инвертирующий вход усилителя, V2 на неинвертирующий. +Vsupply и -Vsupply - положительное и отрицательное питание соответственно. Vdif - входной дифференциальный сигнал, а Vout - выходной сигнал.~\cite{B4}

\begin{figure}[!htb]
    \centering
    \includegraphics[width=0.6\textwidth]{pics/opamp.png}
    \caption{Операционный усилитель}
    \label{fig:opa}
\end{figure}
\FloatBarrier









\subsubsection{Основные параметры}\label{sec:Param}

Итак, рассмотрим основные параметры операционного усилителя:
\begin{enumerate}
    \item A- коэффициент усиления при разомкнутой петле, то есть собственный коэффициент усиления ОУ, без обратной связи. В случае идеального операционного усилителя $A = \infty$
    \item $Z_{in}$ - входной импеданс, является отношением $V_{in}/I_{in}$, которое должно стремиться к бесконечности, что приводит к условию $I_{in} = 0$. Наличие входного тока накладывает ограничения на максимальное значение сопротивлений в цепи обратной связи, а также на возможности согласования по напряжению с источником сигнала.
    \item $Z_{out}$ - выходной импеданс, должен стремиться к нулю. При равенстве выходного сопротивления нулю, операционный усилитель может давать сколь угодно большой ток для нагрузки выходной цепи.~\cite{B12}
    \item Bandwidth (полоса пропускания) - идеальный операционный усилитель имеет бесконечную полосу пропускания. Полоса пропускания реального усилителя ограничена параметром GBW (gain bandwidth product), являющегося произведением его усиления на низкой частоте минус 3дБ на частоту, при которой его усиление уменьшается на 3 дБ (рис.~\ref{fig:Gbw}).~\cite{B12} 
    $$GBW = G_{3db} * f_{3db}$$
    \begin{figure}[!htb]
    \centering
    \includegraphics[width=0.7\textwidth]{pics/gbw.png}
    \caption{Определение полосы пропускания}
    \label{fig:Gbw}
    \end{figure}
    
    \item Vio - напряжение смещения. В идеальном усилителе при одинаковых входных сигналах выходной сигнал будет нулевым. В реальности существует напряжение смещения, на входе усилителя, поэтому даже при равных входных сигналах выход будет не нулевым. Другими словами, реальный ОУ ведет себя как идеальный ОУ, у которого последовательно с одним из входов подключен генератор напряжения Vio.~\cite{B6}
    
    \item PSRR - коэффициент подавления нестабильности питания. У идеального усилителя изменение напряжения питания ОУ не должно влиять на выходное напряжение. Параметр, который характеризует влияние изменения питания на выходное напряжение для реального усилителя - PSRR определяется следующей формулой:
    $$PSRR = 20 log_{10}(\frac{\Delta V_{supply}}{\Delta V_{out}} * A_{v})$$
    \item Settling time - время установления. На рис~\ref{fig:Time} обозначен как Ts. Данная характеристика показывает как быстро установится выходной сигнал усилителя, работающего в режиме повторителя, при резком изменении входного сигнал.~\cite{B5}
    \begin{figure}[!htb]
    \centering
    \includegraphics[width=0.7\textwidth]{pics/time.png}
    \caption{Время установления}
    \label{fig:Time}
    \end{figure}
    
    \item Power consumption - энергопотребление. Этот показатель обычно измеряется в 2-х режимах, динамическом и статическом.
    \item CMRR – или КОСС (коэффициент подавления симфазного синфазного сигнала) показывает способность усилителя подавлять симфазный синфазный сигнал. Выходной сигнал операционного усилителя определяется формулой $V_{O}= A_{d}*(V_{+} - V_{-})$, но в реальном ОУ симфазный синфазный сигнал тоже усиливается, поэтому: $V_{O}= A_{d}*(V_{+} - V_{-})+ \frac{1}{2}*A_{cm}*(V_{+}+ V_{-})$, где $A_{d}$ – коэффициент усиления дифференциального сигнала, а $A_{cm}$ - коэффициент усиления симфазного синфазного сигнала. В виду наличия различных коэффициентов усиления, можем определить CMRR:
    $$CMRR = 20*lg(\frac{A_{d}}{|A_{cm}|})$$
    \item Скорость нарастания и спада выходного напряжения(slew rate). Данная характеристика определяется по реакции ОУ на воздействие скачка напряжения на входе и выражается в виде отношения приращения выходного напряжения к времени на участке изменения от 0.1 Uвых до 0.9Uвых.~\cite{B5}
\end{enumerate}

Также важными характеристиками ОУ являются АЧХ, ФЧХ и запас по фазе. Данные частотные характеристики рассмотрим подробнее.
\FloatBarrier







\subsubsection{АЧХ и ФЧХ операционного усилителя}

Усиление гармонических сигналов зависит от частотных характеристик операционного усилителя. Зависимость коэффициента усиления от частоты представляется в виде кривой, которая называется АЧХ (амплитудно-частотная характеристика).
На (рис.~\ref{fig:Ku}) представлена АЧХ типичного операционного усилителя,  с внутренней коррекцией.

\begin{figure}[!htb]
\centering
\includegraphics[width=0.7\textwidth]{pics/ku.png}
\caption{АЧХ типичного ОУ}
\label{fig:Ku}
\end{figure}

На низких частотах коэффициент усиления максимален и почти не зависит от частоты. АЧХ начинает спадать на частоте fср. Причина спада коэффициента усиления заключается в частотной зависимости паразитных емкостей транзисторов схемы ОУ и емкости коррекции. fгр (частота среза) - частота при которой коэффициент усиления падает в корень квадратный из 2 раз (-3db), данная частота определяет полосу.~\cite{B5}





\subsubsection{Устойчивость}\label{sec:stability}

Большинство схем, построенных на ОУ работают в схеме с отрицательной обратной связью, определяемой коэффициентом β. Небольшая часть данных схем будет рассмотрена в~§\ref{sec:modes}. При глубокой отрицательной обратной связи  | βKu |>>1, где Ku - коэффициент усиления ОУ не охваченного обратной связью (рис.~\ref{fig:Feed})..~\cite{B7}

\begin{figure}[!htb]
\centering
\includegraphics[width=0.7\textwidth]{pics/feedback.png}
\caption{Структурная схема усилителя с обратной связью}
\label{fig:Feed}
\end{figure}

К сожалению, системы такого рода, имеющие большой коэффициент усиления, при наличии обратной связи склонны к неустойчивости. В ОУ могут возникнуть автоколебания при изменении фазы на 180°, то есть выходной сигнал усилителя перестанет зависеть от входного. Генерации возникают при | βKu | = 1.

Фазовый сдвиг операционного усилителя, разрабатываемого для универсальных приложений при |KU|  > 1 должен быть по абсолютной величине меньше 120°. При этом условии для любого коэффициента 0 < β < 1  запас по фазе будет составлять не менее 60°.~\cite{B7} 

Это требование достигается с использованием коррекции (рис.~\ref{fig:Corr}).

Как мы видим из диаграммы при использовании корректировочного конденсатора запас по фазе операционного усилителя, даже при β = 1, на частоте единичного усиления α = 65°.

\begin{figure}[!htb]
\centering
\includegraphics[width=0.7\textwidth]{pics/correction.png}
\caption{АЧХ ОУ с использованием емкости коррекции}
\label{fig:Corr}
\end{figure}
\FloatBarrier

Многие схемы операционных усилителей имеют внутреннюю коррекцию, которая уменьшает полосу пропускания усилителя и предотвращает генерацию ОУ на высоких частотах. Обычно в роли корректора выступает конденсатор малой емкости. Данный конденсатор помечен красным на рисунке~\ref{fig:Ccorr}.

\begin{figure}[!htb]
\centering
\includegraphics[width=0.7\textwidth]{pics/Ccorr.png}
\caption{Емкость коррекции в ОУ}
\label{fig:Ccorr}
\end{figure}








\subsubsection{Режимы работы операционного усилителя}\label{sec:modes}
Рассмотрим несколько режимов работы операционного усилителя при различных обратных связях:
\begin{enumerate}
    \item Инвертирующий (рис.~\ref{fig:Inv}) и неинвертирующий (рис.~\ref{fig:Invn't}) операционный усилитель:
    \begin{figure}[!htb]
        \begin{subfigure}[b]{0.45\textwidth}
            \includegraphics[width=\textwidth]{pics/inv.png}
            \subcaption{в инвертирующем включении}
            \label{fig:Inv}
        \end{subfigure}
        \begin{subfigure}[b]{0.45\textwidth}
            \includegraphics[width=\textwidth]{pics/invn't.png}
            \subcaption{в неинвертирующем включении}
            \label{fig:Invn't}
        \end{subfigure}
        \caption{Оперрационный усилитель} 
    \end{figure}
    \FloatBarrier
    При условии, что $R_{f}/R_{in} = 0$ неинвертирующий усилитель будет работать в режиме повторителя.
    
    \item Суммирующий (рис.~\ref{fig:Sum})  и вычитающий (рис.~\ref{fig:Sub}) усилитель:
    \begin{figure}[!htb]
        \begin{subfigure}[b]{0.45\textwidth}
            \includegraphics[width=\textwidth]{pics/sum.png}
            \subcaption{Суммирующий ОУ}
            \label{fig:Sum}
        \end{subfigure}
        \begin{subfigure}[b]{0.45\textwidth}
            \includegraphics[width=\textwidth]{pics/sub.png}
            \subcaption{Вычитающий ОУ}
            \label{fig:Sub}
        \end{subfigure}
        \caption{} 
    \end{figure}
    
    \item Наконец существует еще 2 различных включения, когда ОУ становится:интегрирующий(рис.~\ref{fig:Int})  и дифференциирующий(рис.~\ref{fig:Diff}). Именно схема интегратора важна нам для функционирования ПНЧ, поэтому рассмотрим ее подробнее в следующей главе.
    \begin{figure}[!htb]
        \begin{subfigure}[b]{0.45\textwidth}
            \includegraphics[width=\textwidth]{pics/int.png}
            \subcaption{Интегратор}
            \label{fig:Int}
        \end{subfigure}
        \begin{subfigure}[b]{0.45\textwidth}
            \includegraphics[width=\textwidth]{pics/diff.png}
            \subcaption{Дифференциирующий ОУ}
            \label{fig:Diff}
        \end{subfigure}
        \caption{} 
    \end{figure}
    \FloatBarrier
\end{enumerate}



\subsubsection{Интегратор}

Рассмотрим подробно работу интегратора, представленного на рисунке~\ref{fig:Integrator}.
\begin{figure}[!htb]
\centering
\includegraphics[width=0.7\textwidth]{pics/integrator.png}
\caption{Интегратор}
\label{fig:Integrator}
\end{figure}

Входной сигнал интегратора $V_{in}$ преобразовывается в ток, заряжающий конденсатор C.
$$V_{out} = \frac{1}{C}\int_{-\infty}^{t} I_{c}(\tau) d\tau$$

Для операционного усилителя можно применить метод виртуальной земли (в виду наличия отрицательной обратной связи и высокого коэффициента усиления).~\cite{B15} Тогда выходное напряжение Vout можно представить следующим выражением:
$$V_{out} = -\frac{1}{RC}\int_{-\infty}^{t} V_{in}(\tau) d\tau$$

Теперь разделим приделы интегрирования на 2 части -∞ до 0 и от 0 до t. Тогда Vout:
$$V_{out} = V_{0}-\frac{1}{RC}\int_{-\infty}^{t} V_{in}(\tau) d\tau$$
Где $V_{0}$ - напряжение, которое в начальный момент было на выходе усилителя.
Итак, на операционный усилитель накладываются определенные требования, необходимые для повышения точности вычислений. Во-первых, у усилителя должен быть высокий коэффициент усиления. Во-вторых, необходимо обеспечить стабильность нуля: при $V_{in} = 0$, $V_{out}$ тоже должен быть равен нулю (однако, смещение нуля реального усилителя ведет к наличию дрейфа выходного напряжения при $V_{in} = 0$)..~\cite{B9}

\subsubsection{Типы схем операционных усилителей(ОУ)}

Параметры, которые определяют качество операционного усилителя, были рассмотрены в разделе \ref{sec:Param}. Рассмотрим различные типы схем ОУ, и сравним их по вышеперечисленным параметрам. 




\paragraph{Однокаскадный усилитель}~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

На рисунке~\ref{fig:Single} изображены простейшие однокаскадные усилители, на рисунке~\ref{fig:Single}а с однополярным выходом, на рисунке~\ref{fig:Single}b с дифференциальным выходом

\begin{figure}[!htb]
\centering
\includegraphics[width=1\textwidth]{pics/single.png}
\caption{Однокаскадный усилитель a)с однополярным выходом b)с дифференциальным выходом}
\label{fig:Single}
\end{figure}

При малосигнальном анализе данного усилителя получаем следующие характеристики:
\begin{enumerate}
    \item Коэффициент усиления $A = g_{mN}(r_{ON}||r_{OP})$  (A <= 20)
    \item GB определяется нагрузочной емкостью $C_{L}$. 
    \item Output swing: [$V_{IC}- V_{TN}$;$V_{DD}- V_{SG4}+|V_{TP} |$], следует из условия, что транзисторы M2 и M4 должны находится в режиме насыщения..~\cite{B8}
\end{enumerate}

Также помимо простейшего однокаскадного ОУ можно использовать телескопический каскод(рис.~\ref{fig:tel}).

\begin{figure}[!htb]
\centering
\includegraphics[width=0.9\textwidth]{pics/telcascode.png}
\caption{Однокаскадный усилитель a)с однополярным выходом b)с дифференциальным выходом}
\label{fig:tel}
\end{figure}
\FloatBarrier

Для него справедливы следующие параметры:
\begin{enumerate}
    \item Коэффициент усиления $A= g_{mN} [(g_{mN} * r_{ON}^2  ||g_{mP} * r_{OP}^2 )$
	\item Output swing: $2$ $*$ [$V_{DD}-(V_{OD1}+ V_{OD3}+ V_{CSS}+|V_{OD5} |+|V_{OD7} |)$], где $V_{ODj}$ – превышение напряжения над порогом. 
\end{enumerate}
Для каскаода коэффициент усиления становится существенно выше, но при этом диапазон выходных напряжений снижается.~\cite{B16}







\paragraph{Свернутый каскод(folded cascode)}~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Телескопический каскодный усилитель позволяет достичь высокого коэффициента усиления, но при этом сильно ограничивает диапазон выходных напряжений. Для того, чтобы устранить данную проблему, необходимо использовать свернутый каскод рисунок~\ref{fig:Fold}.~\cite{B5}
\begin{figure}[!htb]
\centering
\includegraphics[width=0.5\textwidth]{pics/fold.png}
\caption{Преобразование телескопического усилителя в свернутый}
\label{fig:Fold}
\end{figure}
\FloatBarrier

Из данного рисунка мы видим, что в преобразованных схемах снижается ограничение по питанию. Данная техника позволяет существенно улучшить параметры ОУ основанного на телескопическом каскоде. На рисунке~\ref{fig:Foldopa} мы видим дифференциальный усилитель основанный на телескопическом каскоде и на сложенном..~\cite{B8}

\begin{figure}[!htb]
\centering
\includegraphics[width=0.9\textwidth]{pics/foldopa.png}
\caption{Преобразование телескопического(слева) ОУ в свернутый(справа)}
\label{fig:Foldopa}
\end{figure}
\FloatBarrier

Отметим отличия этих двух схем:
\begin{enumerate}
    \item В схеме на рисуноке~\ref{fig:Foldopa}(слева) один опорный ток, $I_{ss}$, задает токи истока одновременно и для входных транзисторов, и для каскода.  В схеме на рисуноке~\ref{fig:Foldopa}(справа) каждая часть требует свой опорный ток: $I_{SS1}=\frac{I_{SS}}{2}+I_{D3}$
	\item 	Синфазное напряжение в схеме рисунок~\ref{fig:Foldopa}(слева) не может превысить уровень $V_{b1}-V_{GS3}+V_{TH1}$, в свою очередь в схеме рисунок~\ref{fig:Foldopa}(справа) синфазное напряжение не может быть ниже, чем $V_{b1}-V_{GS3}+|V_{TH1}|$
\end{enumerate}
Итого мы получаем следующую схему операционного усилителя - рисунок~\ref{fig:Opafold}.
\begin{figure}[!htb]
\centering
\includegraphics[width=0.7\textwidth]{pics/opafold.png}
\caption{Свернутый каскод как часть ОУ}
\label{fig:Opafold}
\end{figure}
\FloatBarrier
Для такой схемы диапазон выходных напряжений составит:

Peak-peak swing = [$V_{DD}-(V_{OD7}+ V_{OD9}$]$-(V_{OD3}+V_{OD5})$ для одной стороны.

\begin{figure}[!h]
    \begin{subfigure}[b]{0.33\textwidth}
        \includegraphics[width=\textwidth]{pics/small1.png}
        \subcaption{половина схемы}
        \label{fig:sm1}
        \center{$A_{v} = G_{m}R_{out}$}
    \end{subfigure}%
    \begin{subfigure}[b]{0.33\textwidth}
        \includegraphics[width=\textwidth]{pics/small2.png}
        \subcaption{Эквивалентная схема при заземленном выходе}
        \label{fig:sm2}
        \center{$G_{m}\approx g_{m1}$}
    \end{subfigure}%
    \begin{subfigure}[b]{0.33\textwidth}
        \includegraphics[width=\textwidth]{pics/small3.png}
        \subcaption{Эквивалентная схема при открытом выходе}
        \center{$R_{OP} \approx (g_{m7} + g_{mb7}) * r_{o7}r_{o9}$}
        \center{$R_{out} \approx R_{OP} || (g_{m3} + g_{mb3})r_{o3}(r_{o1} || r_{o5})$}
        \label{fig:sm3}
    \end{subfigure}%
    \label{fig:small}
    \caption{Малосигнальная модель усилителя} 
\end{figure}
\FloatBarrier

Итак, формула для коэффициента усиления определяется следующей формулой:
\begin{figure}[!h]
    \center{$|A_{V}| \approx g_{m1} *$ ([$(g_{m3} + g_{mb3})r_{o3}(r_{o1} || r_{o5})$] || [$(g_{m7} + g_{mb7}) * r_{o7}r_{o9}$])}
\end{figure}

Обычно коэффициент усиления в 2 или 3 раза ниже, в сравнении с телескопическим каскодом. Итого, мы получаем, что при использовании сложенного каскода диапазон выходного напряжения увеличивается, но при этом падает коэффициент усиления, уменьшается GB, а также схема генерит больше шума.









\paragraph{Двухкаскадный усилитель}~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Для того чтобы получить преимущества сложенного каскода или телескопического: получить большой коэффициент усиления, и при этом иметь широкий диапазон выходных напряжений - необходимо использовать двухкаскадный ОУ. Схематично он представлен на рисунке~\ref{fig:stage}.

\begin{figure}[!htb]
\centering
\includegraphics[width=0.7\textwidth]{pics/stage.png}
\caption{Структурная схема двухкаскадного усилителя}
\label{fig:stage}
\end{figure}

Данный тип ОУ состоит из двух каскадов, 1 каскад создает большой коэффициент усиления, а второй увеличивает диапазон выходных напряжений. При использовании более 2-х каскадов усложняется обеспечение стабильности (\ref{sec:stability}), поэтому усилители с числом каскадов более 2-х редко используются.\bibitem{B5} Простейшая схема двухкаскадного усилителя представлена на рисунке~\ref{fig:simple2}.

\begin{figure}[!htb]
\centering
\includegraphics[width=0.7\textwidth]{pics/simple2.png}
\caption{Простейшая схема двухкаскадного усилителя}
\label{fig:simple2}
\end{figure}

Определим коэффициент усиления данной схемы:
$$A_{v,1 каскад} = g_{m1,2} (r_{o1,2}  ||  r_{o3,4})$$
$$A_{v,2 каскад}= g_{m5,6} (r_{o5,6}  ||  r_{o7,8})$$

Суммарный коэффициент находится по формуле:
$$A_{v}= A_{v,1 каскад}* A_{v,2 каскад}$$
Диапазон выходных напряжений = $V_{DD} - |V_{OD5,6}|- V_{OD7,8}$

Если в данной схеме использовать каскод, тогда ОУ будет представлен следующим образом(рисунок~\ref{fig:simple2})
\begin{figure}[!htb]
\centering
\includegraphics[width=0.7\textwidth]{pics/simple2.png}
\caption{Простейшая схема двухкаскадного усилителя}
\label{fig:simple2}
\end{figure}
\FloatBarrier















\paragraph{Сравнение}~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Результаты сравнения рассмотренных выше схем представлены в таблице~\ref{Compare}
\begin{table}[!htb]
\centering
\caption{Сравнение различных типов ОУ}
\label{Compare}
    \begin{tabular}{|l|l|l|l|l|l|}
    \hline
                           & Av      & Output Swing & Задержка & Потребление & Шум     \\ \hline
    Телескопический каскод & Средний & Средний      & Высокая  & Высокое     & Низкий  \\
    Сложенный каскод       & Средний & Средний      & Средняя  & Среднее     & Средний \\
    Двухкаскадный          & Высокий & Высокий      & Низкая   & Среднее     & Средний  \\ \hline
    \end{tabular}
\end{table}

Для проектируемого усилителя возьмем за основу двухкаскадный операционный усилитель со свернутым каскодом. Также для уменьшения смещения нуля необходимо будет использовать методы описанные в следующем параграфе.~\cite{B13}









\subsubsection{Методы минимизации смещения нуля}

Для увеличения точности ПНЧ необходимо уменьшать смещение нуля (offset) усилителя. Существует множество способов, которые помогают решить эту проблему. Первые два метода основаны на сохранении напряжения смещения усилителя на конденсаторе, который помещается последовательно с усилителем: на вход или на выход, в зависимости от используемой техники(«auto-zero» и «zero-drift» technique). Однако при этом конденсаторы оказывают влияние на входной сигнал, блокируя постоянный ток полезного сигнала и ослабляя его на низких частотах. Мы могли бы применять данный тип стабилизации в случае, когда входной сигнал является высокочастотным, но для ПНЧ также важны и низкие частоты, для обработки низкочастотных сигналов поступающих с датчиков. Также существуют такие техники как чопперная стабилизация и различные типы калибровок. Рассмотрим их подробнее.~\cite{B12}






\paragraph{Чопперная стабилизация}~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Принцип работы данной техники представлен в виде блок схемы на рисунке~\ref{fig:chop1}.

\begin{figure}[!htb]
\centering
\includegraphics[width=0.8\textwidth]{pics/chop1.png}
\caption{Чопперная стабилизация}
\label{fig:chop1}
\end{figure}
\FloatBarrier

Здесь усилитель представлен в виде идеальной части с коэффициентом A, и неким смещением $V_{os}$ который прибавляется ко входному сигналу. Входной сигнал $V_{in}(t)$ проходит через модулятор (чоппер) после чего выходной сигнал чоппера V1(t) представляет собой функцию p(t) модулируемую Vin(t). Аналогичная модуляция осуществляется и над выходным сигналом усилителя $V_{2}(t)$. Теперь рассмотрим графики на рисунке~\ref{fig:chop1}. На первой временной диаграмме мы видим входной сигнал и напряжение смещение, которое не зависит от времени. Далее представлен сигнал чоппера p(t), который представляет собой периодический прямоугольный сигнал, с максимальным значением 1 и минимальным -1. После того как входной сигнал прошел через чоппер мы получили сигнал $V_{1}(t) = V_{in}(t) * p(t)$. Далее на вход усилителя приходит сигнал $V = V_{1} + V_{os}$, и усиливается в A раз. После прохождение через чоппер выходной сигнал имеет вид, как на последней временной диаграмме (рис.~\ref{fig:chop1}), и определяется формулой:
$$V_{out}(t) = A * p^2(t) * V_{in}(t) + A * V_{os} * p(t)$$
Так как $p^2(t) = 1$, чоппер не будет влиять на входной сигнал. При этом если смещение нуля приведенное к выходу усреднить по времени, оно станет равным нулю.
На практике чоппер представляет собой наборы ключей, которые синхронно меняют полярность входа и выхода операционного усилителя (рис.~\ref{fig:chop2}).~\cite{B10}

\begin{figure}[!htb]
\centering
\includegraphics[width=0.8\textwidth]{pics/chop2.png}
\caption{Реализация чопперной стабилизации в ОУ}
\label{fig:chop2}
\end{figure}
\FloatBarrier

Работа чоппера происходит в 2 фазы. В фазу 1 операционный усилитель работает в нормальном режиме, при фазе 2 полярность входа и выхода усилителя меняется.

Чопперная стабилизация позволяет существенно снизить среднее значение смещения нуля, но не может устранить его полностью. 

Однако, чопперная стабилизация вносит в смещение нуля динамическую составляющую, связанную с:

\begin{enumerate}
    \item асимметрией времен переключения ключей чоппера
	\item асиметрией помех от выбросов зарядов при переключении ключей
	\item асимметрией фронтов выходного сигнала усилителя при переключении чоппера из-за различия в скоростях нарастания и спада выходного сигнала
\end{enumerate}

Очевидно, что величина такой динамической составляющей смещения, вызванной переключением ключей, пропорциональна частоте переключения чоппера.

Кроме того, чопперная стабилизация применима к усилителю с дифференциальным выходом, поэтому необходимо преобразование  дифференциального выхода чоппера в однопроводной выход интегратора. Каскад (или усилитель), реализующий это преобразование,  имеет смещение, не устраняемое чоппером, которое пересчитывается ко входу делением на коэффициент усиления охваченного чоппером усилителя..~\cite{B10}







\paragraph{Калибровка дифференциального каскада}

Рассмотрим дифференциальный усилитель, с нагрузкой в виде токового зеркала. Схема токового зеркала изображена на рисунке~\ref{fig:Mirr}.

\begin{figure}[!htb]
\centering
\includegraphics[width=0.3\textwidth]{pics/mirr.png}
\caption{Токовое зеркало}
\label{fig:Mirr}
\end{figure}
\FloatBarrier
Для идеального токового зеркала и согласованных пар транзисторов  т.е W1/L1 = W2/L2 - получаем I2 = I1. В реальном токовом зеркале равенства токов не наблюдается, так как Vds1 не равно Vds2, и существует рассогласование (mismatch) между парами транзисторов  P1, P2 и N1, N2. В итоге появляется ΔI, которое влияет на смещение нуля усилителя. 
Этот эффект также наблюдается и при использовании каскода (рис.~\ref{fig:Cal1}), в котором важна согласованность всех пар транзисторов (P1, P2; N1, N2; PT1, PT2). В идеальном случае I2 = I1, но из-за рассогласования транзисторов появляется ΔI, который вызывает смещение нуля усилителя.  Для того, чтобы уменьшить разность тока, можно использовать калибровку, основанную на использовании ЦАП последовательного приближения и компаратора..~\cite{B11}

Структурная схема данной калибровки приведена на рис.~\ref{fig:Cal1}.

\begin{figure}[!htb]
    \begin{subfigure}[b]{0.45\textwidth}
        \includegraphics[width=\textwidth]{pics/calibr2.png}
        \subcaption{структурная схема}
        \label{fig:Cal1}
    \end{subfigure}
    \begin{subfigure}[b]{0.45\textwidth}
        \includegraphics[width=\textwidth]{pics/calibr1.png}
        \subcaption{внутри ОУ}
        \label{fig:Cal2}
    \end{subfigure}
    \caption{Калибровка смещения} 
\end{figure}
\FloatBarrier

В фазе калибровки оба входа операционного усилителя INM и INP переключаются на землю (в режиме калибровки CAL = 1). В идеальном случае на выходе был бы ноль, но в виду ранее описанных проблем, выходное напряжение будет не нулевым. Компаратор сравнивает это значение с нулем и передает реверсивный счетчик (регистр последовательного приближения SAR). При CK (тактовый сигнал) и CAL равных 1 счетчик начинает считать, в зависимости от номера такта и результата компарирования. ЦАП берет значение данного счетчика и в зависимости от этого  устанавливает величину напряжений на входах TP и TM. На рисунке~\ref{fig:Cal2} изменение напряжений на затворах транзисторов PT1 и PT2 изменяют токи I1 и I2, приводя в результате последовательного приближения к уменьшению выходного напряжения усилителя. После окончания калибровки, в усилитель будут добавляться калибровочные токи, минимизирующие выходное напряжение усилителя.

\clearpage




\section{Разрабатываемый ПНЧ}

С целью создания систем прецизионного непрерывного мониторинга аналоговых сигналов поставлена задача разработки многоканального ПНЧ, удовлетворяющего повышенным требованиям по точностным и скоростным параметрам. Ниже приведены требования к интегратору разрабатываемого ПНЧ. Поскольку точностные параметры ПНЧ определяются параметрами усилителя интегратора, для оценки соответствия параметров разрабатываемого усилителя требованиям ПНЧ рассмотрим подробно параметры ПНЧ и интегратора.





\subsection{Параметры ПНЧ}\label{sec:parameters}

Целевые требования к параметрам интегратора, определяемые требованиями ТЗ на микросхему ПНЧ представлены в таблице Таблица~\ref{fig:Table2}. Целевые требования к параметрам интегратора определены с учетом технологического запаса 100\%.

\begin{table}[!htb]
    \centering
    \includegraphics[width=1\textwidth]{pics/table2.png}
    \caption{Требования ТЗ на параметры ПНЧ и целевые параметры интегратора}
    \label{fig:Table2}
\end{table}
\FloatBarrier

В таблице~\ref{fig:Table3} приведены предельный и предельно-допустимый режимы эксплуатации ПНЧ.

\begin{table}[!htb]
    \centering
    \includegraphics[width=1\textwidth]{pics/table3.png}
    \caption{Предельный и предельно-допустимый режимы эксплуатации ПНЧ}
    \label{fig:Table3}
\end{table}
\FloatBarrier

Требуемую совокупность параметров можно обеспечить   только в синхронном балансирующем ПНЧ, позволяющем достичь максимальной точности и стабильности преобразования. 







\subsection{Структурная схема канала разрабатываемого ПНЧ}

Рассмотрим структурную схему канала ПНЧ - Рисунок~\ref{fig:VFC}. 

\begin{figure}[!htb]
\centering
\includegraphics[width=1\textwidth]{pics/vfc.png}
\caption{Структурная схема канала проектируемого ПНЧ}
\label{fig:VFC}
\end{figure}
\FloatBarrier

Основой канала интегрирующего преобразователя напряжения в частоту (ПНЧ) является интегратор, включающий усилитель ОУ с конденсатором обратной связи $C_{int}$ и резистивно-ключевая схема коммутации входа интегратора int\_sw. 

Положительное опорное напряжение $V_{ref}$ можно использовать как внешнее, так и внутреннее. Номинальная величина опорного напряжения $V_{ref}$ = 1.25 В.  Инвертирующий операционный усилитель формирует общее для всех каналов отрицательное опорное напряжение  $V_{refb}$ = -1.25В. Буферные усилители с подстройкой смещения нуля в каждом канале формируют индивидуально калибруемые отрицательные опорные напряжения $V_{refb_{i}}$. 

В нормальном режиме напряжение на входе In преобразуется в ток и попадает на вход интегратораи увеличивая или уменьшая выходное напряжение интегратора, в зависимости от полярности входного напряжения Если напряжение выхода интегратора превысит $V_{ref}$ то сработает компаратор CpT и откроет ключ SwT. Аналогично, если напряжение выхода интегратора будет меньше $V_{refb}$ сработает компаратор CpB и откроет ключ SwB. Сигналы ft, fb управления ключами синхронизуются передним фронтом тактового сигнала $F_{clk}$. 







\subsection{Режимы работы}

Интегрирующий преобразователь напряжения в частоту (и интегратор) работают в соответствии с ниже приведенным уравнением состояния
$$F_{out} = \frac{V_{in}}{V_{ref}} \frac{R_{rev}}{R_{in}} \frac{1}{T_{rev}}$$
$$V_{out} = \frac{V_{ref} * T_{rev}}{R_{rev} * C_{int}}$$ , где:
\begin{itemize}
    \item $F_{out}$	- выходная частота                                    (100 … 800 кГц)
    \item $V_{in}$	- входное напряжение                               (-4 … +4 В)
    \item $V_{ref}$	- напряжение опоры                                  (± 1.25 В)
    \item $C_{int}$	- ёмкость конденсатора интегратора       (100 ±15\%,  200 ±15\%)
    \item $V_{out}$	- максимальная (при $V_{in}$=0) амплитуда пульсаций выхода интегратора (<2*$V_{ref}$)
    \item $T_{rev}$	- длительность фазы возврата                 (0.5 …. 4 мкс)
    \item $R_{rev}$	- сопротивление резистора возврата       (16,   8 )  кОм
    \item $R_{in}$	- сопротивление резистора входа             ( $4*R_{ref}$,  $8*R_{ref}$ )
\end{itemize}

На каждый параметр накладываются ограничения, заданные техническим заданием~\ref{sec:parameters}. Из уравнений видно, что на выходную частоту пропорциональна отношению входного сигнала к опорному напряжению, отношению сопротивлений цепи возврата к входному и обратно пропорционально времени включения цепи возврата $T_{rev}$. 

Для повышения универсальности ПНЧ предусмотрены различные режимы работы. Каждый режим характеризоваться своим набором параметров. 

Ниже представлены следующие основные режимы работы ПНЧ и соответственно интегратора (режим, устанавливаемый по умолчанию при включении питания, выделен зеленым цветом.

\begin{itemize}
    \item Опора: внутренняя ±1.25В / {\color{green}внешняя 1.25В}
    \item Режим: Нормальный / калибровка /
    \item Частота чоппера: $F_{ch}= F_{clk}$/({\color{green}512}, 256, 128, 64, 32, 16)
    \item Длительность импульса возврата: $T_{rev}=T_{clk}$*(8, {\color{green}16}, 32, 64, 128)
    \item Потребление :  нормальный / {\color{green}power down}
    \item Конденсатор интегратора: $C_{int}$= 200пФ / 100пФВходное сопротивление: $R_{in}$= {\color{green}64 кОм} / 128 кОм
    \item Сопротивление цепи возврата: $R_{rev}$=: {\color{green}8 кОм} / 16 кОм
    \item Уменьшенные опорные напряжения в режиме калибровки: {\color{green}±10мВ}
    \item В режиме по умолчанию: при {\color{green}$F_{clk}$=8МГц $F_{out}$=200кГц}
\end{itemize}


\clearpage






\section{Постановка задачи и требования к ОУ для интегратора}


Интегратор является основой ПНЧ. Изучив требования к параметрам и архитектурные особенности ПНЧ и интегратора, приступаем к проектированию операционного усилителя для интегратора. Прежде всего, сформулируем базовые требования к схеме ОУ интегратора, определяемые требуемыми параметрами ПНЧ:

\begin{enumerate}
    \item Использование технологии чоппер-стабилизации для обеспечения малого смещения нуля входа с высокой стабильностью (и соответственно, малой и стабильной выходной частоты ПНЧ при заземленном входе).
	\item Токовые входы подстройки смещения нуля усилителя путем введения токов подстройки в плечи каскода вне контура чоппер-стабилизации для обеспечения динамической калибровки смещения нуля усилителя при активном чоппере.
	\item Высокий коэффициент усиления усилителя и первого каскада на максимальной частоте выходного сигнала интегратора для обеспечения высокой стабильности смещения нуля и линейности. ($F_{out_{max}}$=200кГц.   максимальная выходная частота интегратора, при которой специфицируются точностные параметры ПНЧ).
	\item Низкоомный комплементарный выходной каскад с максимально высокими и равными скоростями нарастания и спада выходного сигнала в диапазоне выходных напряжений ±1.4В в обеспечение малых и стабильных ошибок шкалы преобразования и линейности ПНЧ.
\end{enumerate}


С учетом вышеперечисленных требований,  необходимо создать прецизионный усилитель с высоким коэффициентом усиления и малымсмещением нуля с высокой стабильностью с применением  чоппер-стабилизацией и дополнительной калибровкой.

\clearpage




\section{Разработка ОУ}
\subsection{Структурная схема}

Определившись с основными параметрами, которыми должен обладать ОУ, нарисуем его структурную схему (рис.~\ref{fig:struct1}).

\begin{figure}[!htb]
\centering
\includegraphics[width=0.7\textwidth]{pics/struct1.png}
\caption{Структурная схема проектируемого ОУ}
\label{fig:struct1}
\end{figure}

ОУ является двухкаскадным, что обеспечит ему высокий коэффициент усиления. Дифференциальный каскад (каскад 1) охвачен чоппером, что позволяет минимизировать смещение нуля и обеспечить его стабильность во времени и в диапазоне условий эксплуатации. В виду того что выходной каскад (каскад 2) имеет однополярный выход, его невозможно охватить контуром чоппер-стабилизации, поэтому смещение, выходного каскада не устраняется чоппером. Для уменьшения составляющих смещения, связанных с неидеальностью чоппера и смещением второго каскада введена динамическая калибровка смещения чоппера и второго каскада. Схема имплементации чоппера и динамической калибровки в ОУ изображены на рисунке~\ref{fig:struct2}. 

\begin{figure}[!htb]
\centering
\includegraphics[width=0.7\textwidth]{pics/struct2.png}
\caption{Схема имплементации чоппера и динамической калибровки в ОУ}
\label{fig:struct2}
\end{figure}

Чоппер представлен в виде ключей, которые переключаются в зависимости от текущей фазы работы: f1 и f2





\subsection{Схема проектируемого ОУ}

Упрощенная схема операционного усилителя представлена на рисунке~\ref{fig:opa}

\begin{figure}[!htb]
\centering
\includegraphics[width=1\textwidth]{pics/opa.png}
\caption{Упрощенная схема проектируемого ОУ}
\label{fig:opa}
\end{figure}

Усилитель состоит из нескольких основных блоков, обозначенных пунктиром:	


\begin{enumerate}
    \item Входной ({\color{red}- - - -}) и выходной ({\color{purple}- - - -}) чоппер.
	\item Вход первого каскада ({\color{yellow}- - - -})
	\item Формирователь раздельных сигналов управления n- и p-канальными выходными транзисторами (- - - -)
	\item Динамическая калибровка ({\color{green}- - - -})
	\item Выходной каскад ({\color{magenta}- - - -})
\end{enumerate}

Усилитель интегратора выполнен по двух каскадной схеме с комплементарным дифференциальным входом. Первый каскад усиления представлен симметричным комплементарным каскодом с высоким коэффициентом усиления, охваченным контуром чоппер-стабилизации. Комплементарный выходной каскад с активными nMOS и рMOS транзисторами обеспечивает дополнительное усиление и высокие и равные скорости нарастания и спада выходного сигнала.

Входные ключи чоппер-стабилизатора выполнены низковольтными nMOS транзисторами для уменьшения помех переключения и динамического входного тока от переключения ключей. Две пары выходных ключей чоппер-стабилизатора, выполнены на 5В nMOS  и рMOS транзисторах. Входные низковольтные ключи чоппер-стабилизатора управляются 1.8В сигналами с<1:0>, а  выходные  ключи управляются 3В сигналами с<3:2>.

Втекающие токи ioffsn<1>, ioffsp<1> динамической калибровки смещения добавляются к токам соответствующих плечей дифференциального каскода, сдвигая смещение нуля выхода усилителя в отрицательную сторону  для тока ioffsn и в положительную сторону для тока ioffsp. Для обеспечения стабильности откалиброванного смещения в диапазоне температур и напряжения питания зависимости токов калибровки и тока смещения усилителя от температур и напряжения питания должна быть аналогичны, что достигается специальной конструкцией токового ЦАП, формирующего токи калибровки.

\clearpage






\section{Моделирование операционного усилителя для интегратора}
\subsection{Схема моделирования}

\begin{figure}[!htb]
\centering
\includegraphics[width=1\textwidth]{pics/intmod.png}
\caption{Схема моделирования интегратора}
\label{fig:intmod}
\end{figure}

Схема моделирования усилителя интегратора sim\_int\_amp1, представленная на рисунке~\ref{fig:intmod} включает:

\begin{itemize}
    \item Усилитель интегратора int\_amp
    \item MiM конденсатор интегратора (cmm5t)   C\_CAL=7.36пФ, режима калибровки;
    \item MiM конденсаторы интегратора (cmm5t)   CINTC= CINTВ =95.7пФ, CINTА=49.7пФ;
    \item n-канальные ключи NCC, NCB, NCA, коммутирующие соответствующие конденсаторы интегратора для разных режимов преобразования;
    \item Ключ обнуления выхода интегратора N\_ZERO, управляемый сигналом источника V9, с резистором R0=5.6кОм;
    \item Источники сигналов c<3:0> чоппер-коммутатора V15, V16,V17,V18;
    \item Источники токов калибровки смещения нуля IIoffsp<1:0>, IIoffsn<1:0>;
    \item Источники положительного V0=Vdda и отрицательного V3=Vss  питания;
    \item Источники входного сигнала  V1 (vpwl) для tran-анализа и Vac (vsin) для AC-анализа;
    \item Источник тока смещения I9=ibs (переменная моделирования);
    \item Резистор обратной связи усилителя R11=Rbc (переменная моделирования);
    \item Конденсатор нагрузки выхода С0=Сl  (переменная моделирования);
    \item Конфигурационные элементы схемы R3=Rin, R9=Rinp, R16=Rcal, C2=Cac (Rin, Rinp, Rcal, Cac переменные моделирования);
    \item vpwl источники V11,V12 сигналов vcal, vncal, управляющие ключами режима работы/калибровки: M2, M3, NCA, NCB, NCC.
\end{itemize}

Схема моделирования также содержит паразитные резисторы и индуктивности источников питания.




\subsection{Виды анализа, условия и параметры моделирования}

Нижеприведенные переменные моделирования (Global Variables) конфигурируют схему моделирования для 4-х видов анализа:

\begin{itemize}
    \item tran –моделирование ОУ в режимах калибровки и нормальной работы интегратора
    \item AC - моделирование АЧХ ОУ с разомкнутой обратной связью
    \item AC1 - моделирование АЧХ ОУ с замкнутой емкостной обратной связью
    \item DC - моделирование напряжения смещения нуля ОУ по постоянному току
\end{itemize}

AC моделирование АЧХ ОУ с разомкнутой обратной связью (при Cac=10) позволяет определить коэффициенты усиления усилителя и его каскадов, однако,  в этом моделировании емкости интегратора подключены через большую  емкость Cac на землю, то есть добавляются к емкости нагрузки выхода усилителя, что сильно уменьшает запас по фазе, по сравнению с нормальной работой усилителя в режиме интегратора.
Для более корректной оценки запасов по фазе и усилению используется AC1 моделирование АЧХ ОУ с замкнутой емкостной обратной связью (при Cac=0.5 пФ).



\begin{table}[!htb]
    \centering
    \includegraphics[width=1\textwidth]{pics/table4.png}
    \caption{Переменные моделирования (Global Variables) усилителя-интегратора}
    \label{fig:Table4}
\end{table}
\FloatBarrier

Моделирование во всех видах анализа проводилось в ADEXL Monte-Carlo с 3 сигма вариациями технологии и mismatch для следующих комбинаций условий эксплуатации (Таблица~\ref{fig:Table5}).

Примечания:
\begin{enumerate}
    \item Управляющие логические сигналы ctrl\_cap, ctrl\_out при высоком уровне подключают дополнительные емкость коррекции и секцию выходного nMOS транзистора.
    \item Жирным шрифтом выделен предполагаемый основной режим работы усилителя.
    \item В каждом режиме моделирования проводилось 500 runs со случайными параметрами технологического процесса и mismatch.
\end{enumerate}
    
\begin{table}[!htb]
    \centering
    \includegraphics[width=1\textwidth]{pics/table5.png}
    \caption{Режимы моделирования усилителя интегратора}
    \label{fig:Table5}
\end{table}
\FloatBarrier






\subsection{Результаты моделирования в tran-анализе}

На рисунке~\ref{fig:tran} представлена диаграмма сигналов моделирования усилителя интегратора в tran анализе.

\begin{figure}[!htb]
\centering
\includegraphics[width=1\textwidth]{pics/tran.png}
\caption{Диаграммы работы интегратора в tran анализе}
\label{fig:tran}
\end{figure}

На диаграмме приведена работа усилителя с замкнутой обратной связью с интегрирующей емкостью в режимах калибровки (Сint=7.4пФ, Rcal= Rint=1кОм)  при высоком уровне сигнала vcal (второй стрип сверху) и нормального преобразования (Сint=199пФ, Rin=Rint =64кОм) при низком уровне vcal  и нулевом входном сигнале. 

На верхнем стрипе диаграммы приведены входной (VT(/in) - синий) и выходной (VT(/out) - красный) сигналы усилителя (и интегратора). Отметим, что положительный и отрицательный импульсы входного сигнала, не влияют на выходной сигнал усилителя, поскольку в это время вход усилителя закрывается и переключается на землю высоким уровнем сигнала vcal. 

На втором снизу стрипе приведены сигналы тактовой частоты чоппера VT(/c<0>) – красный и обнуления выхода усилителя  VT(/zero) – синий.  Последний необходим для быстрого возврата выхода усилителя в ноль, независимо от его предшествующего состояния.

На нижнем стрипе приведены токи калибровки смещения нуля: статической IT(IIoffs0 /PLUS) – синий и динамической IT(IIoffs1/PLUS) – красный.  Величины токов калибровки подобраны для компенсации статического (без чоппера) и динамического (с активным чоппером с Fch=100кГц) смещения усилителя в нормальных условиях (T=25C, Vdda=3В, Vss=1.8В) при типовых параметрах технологии. Естественно, эти величины токов в других условиях работы и параметрах технологии, будут компенсировать смещение усилителя с некоторой ошибкой. Однако, наибольшее влияние на величину требуемых  для компенсации смещения токов калибровки оказывает составляющая смещения нуля реального усилителя, обусловленная случайными ошибками согласования идентичных транзисторов.

Моделируются 4 фазы работы усилителя: 

\begin{enumerate}
    \item 0 – 0.5 мс - Токи калибровки и чоппер отсутствуют;
    \item 0 – 1 мс -Включен ток статической калибровки Ioffs0= 4.615нА. Чоппер отсутствует;
    \item 1 – 1.5 мс -Включен ток статической калибровки Ioffs0= 4.615нА. Чоппер включен;
    \item 1.5 – 2 мс  - Включены токи статической Ioffs0 = 4.615нА и динамической Ioffs1 = 6.665нА  калибровок. Чоппер включен.
\end{enumerate}

\begin{table}[!htb]
    \centering
    \includegraphics[width=1\textwidth]{pics/trantable.png}
    \caption{Выборка результатов моделирования усилителя интегратора в tran анализе}
    \label{fig:trantable}
\end{table}
\FloatBarrier






\subsection{Результаты моделирования в ac-анализе}

На рисунке~\ref{fig:Aс} приведена типовая АЧХ, а в Таблице~\ref{fig:actable} выборка результатов моделирования усилителя интегратора с разомкнутой обратной связью в АС анализе.

\begin{figure}[!htb]
\centering
\includegraphics[width=1\textwidth]{pics/ac.png}
\caption{Типовая АЧХ ОУ с разомкнутой обратной связью}
\label{fig:Aс}
\end{figure}

\begin{table}[!htb]
    \centering
    \includegraphics[width=1\textwidth]{pics/actable.png}
    \caption{Выборка результатов моделирования усилителя интегратора в AC анализе}
    \label{fig:actable}
\end{table}
\FloatBarrier

Минимальный коэффициент усиления Ku=106.4 дБ на частоте 1 Гц и Ku200k=53.2 дБ на частоте 200к Гц, при которой нормируются точностные параметры ПНЧ.
Минимальный запас по фазе с разомкнутой обратной связью (phase\_m) при максимальной суммарной емкости нагрузки 250 пФ всего 19.2 град., что может быть приемлемо с учетом того, что в рабочем режиме интегратора емкость нагрузки существенно меньше (не более 150пФ).





\subsection{Результаты моделирования в ac1-анализе}

На рисунке~\ref{fig:Aс1} приведена типовая АЧХ, а в Таблице~\ref{fig:ac1table} выборка результатов моделирования усилителя интегратора с емкостной обратной связью в АС1 анализе.

\begin{figure}[!htb]
\centering
\includegraphics[width=1\textwidth]{pics/ac1.png}
\caption{Типовая АЧХ ОУ с емкостной обратной связью}
\label{fig:Aс1}
\end{figure}

\begin{table}[!htb]
    \centering
    \includegraphics[width=1\textwidth]{pics/ac1table.png}
    \caption{Выборка результатов моделирования усилителя интегратора в AC1 анализе}
    \label{fig:ac1table}
\end{table}
\FloatBarrier

Отметим, что режим моделирования в АС1 анализе с емкостной обратной связью соответствует режиму нормальной работы усилителя в интеграторе ПНЧ. В этом режиме обратная связь обеспечивает единичный коэффициент усиления (Ku200k=0.1 дБ mean ).
В этом включении усилитель имеет хорошие запасы по фазе (минимальный    phase\_m = 66 град ) и усилению (минимальный gain\_m =-17 дБ ). 5 дБ пик усиления на высокой частоте соответствует 80 град. запасу по фазе, что безопасно.






\subsection{Результаты моделирования в dc-анализе}

В Таблице~\ref{fig:dctable} приведены результаты моделирования смещения нуля входа усилителя в DC анализе.

\begin{table}[!htb]
    \centering
    \includegraphics[width=0.7\textwidth]{pics/dctable.png}
    \caption{Результаты моделирование смещения нуля усилителя интегратора}
    \label{fig:dctable}
\end{table}
\FloatBarrier

Типовое (mean) смещения нуля в основном режиме работы усилителя (ctrl\_out=high) составляет 5-6 мкВ, практически не зависит от напряжения питания и очень слабо (± 1 мкВ) зависит от температуры.








\section{Моделирование канала ПНЧ}
\subsection{Схема моделирования}
На рисунке~\ref{fig:integrmode} приведена схема моделирования интегратора в канале ПНЧ.

\begin{figure}[!htb]
\centering
\includegraphics[width=1\textwidth]{pics/integr.png}
\caption{схема моделирования интегратора в канале ПНЧ}
\label{fig:integrmode}
\end{figure}
\FloatBarrier

Схема моделирования интегратора включает:

\begin{itemize}
    \item блок интегратора (NT)
    \item компараторы (PT, CPB)фиксации пересечения напряжением выхода интегратора положительного reft\_th и отрицательного refb\_th пороговых уровней;
    \item резистивные делители, формирующие положительный reft\_th и отрицательный refb\_th пороговые уровни компараторов из опорных напряжений reft и refb соответственно;
    \item инвертор IREFB\_AMP, формирующий отрицательное опорное напряжение refb из положительного reft;
    \item токовый ЦАП IDAC\_REFB калибровки смещения нуля усилителя – инвертора IREFB\_AMP отрицательного опорного напряжения refb;
    \item блок lg логики управления (m162\_logic);
    \item блок st стимулов (stim);
    \item схемы сдвига уровней m162\_lsh\_2to5 и m162\_lsh\_3to5 сигналов cal\_m\_comp \_th и  pd соответственно.
    \item источники питаний, входного сигнала, сигналов управления и токов смещения;
    \item R, C, L паразитные элементы критичных цепей.
\end{itemize}

На рисунке~\ref{fig:diagram} представлена работа ПНЧ после калибровки.

\begin{figure}[!htb]
\centering
\includegraphics[width=1\textwidth]{pics/diagram.jpg}
\caption{Диаграмма работы канала ПНЧ после калибровки}
\label{fig:diagram}
\end{figure}
\FloatBarrier

На диаграммах показаны: изменяющийся входной сигнал (/in), сигнал выхода интегратора(/out), сигналы выходов компараторов (/compb /compt), опорное напряжение 
(/refb\_th = Vrefb и /reft\_th = Vref), частоту чопперной стабилизации(/chopa) и сигналы начала калибровки(cal\_m\_int0). Видно, что выходная частота измененяется пропорционально Vin. 









\subsection{Анализ результатов моделирования}

Важнейшими параметрами ПНЧ, определяемыми в основном усилителем интегратора, являются:
\begin{itemize}
    \item величина и стабильность смещения нуля (выходной частоты f0 при нулевом входном напряжении);
    \item нелинейность преобразования INL и погрешность Efs шкалы преобразования;
    \item шум преобразования (нестабильность выходной частоты, определяемая низкочастотным шумом, частотой тактового сигнала и амплитудой пульсаций выходного напряжения интегратора при переключениях чоппера)
\end{itemize}

Все эти параметры зависят от точности калибровки и ее зависимости от условий эксплуатации. На рисунках~\ref{fig:diagg1} и~\ref{fig:diagg2} приведены типовые зависимости скорости дрейфа выходного напряжения в зависимости от температуры и напряжения питания соответственно. Важным параметром, определяющим величину и стабильность выходной частоты (f0) при нулевом входном напряжении является скорость изменения выходного напряжения интегратора при нулевом входном сигнале (dVo/dt) после калибровки. Выходную частоту при нулевом входном напряжении можно приближенно оценить по формуле: $f0 < (\frac{dV_{o}}{dt}) / V_{oppl}$, где $V_{oppl}$ – амплитуда пульсаций выходного напряжения интегратора при минимальном входном напряжении (0.25В). Знак меньше в вышеприведенной формуле учитывает, что реально достижимая величина dVo/dt будет меньше при увеличении времени timeout, а амплитуда пульсаций выходного напряжения интегратора при входном напряжении менее 0.25В увеличится. Типовое значение  f0 меньше 0.1Гц.

\begin{figure}[!htb]
\centering
\includegraphics[width=0.8\textwidth]{pics/1.png}
\caption{Типовая зависимость скорости изменения выходного напряжения интегратора dVo/dt от температуры}
\label{fig:diagg1}
\end{figure}
\FloatBarrier

\begin{figure}[!htb]
\centering
\includegraphics[width=0.8\textwidth]{pics/2.png}
\caption{Типовая зависимость скорости изменения выходного напряжения интегратора dVo/dt от напряжения питания}
\label{fig:diagg2}
\end{figure}
\FloatBarrier

На рисунках~\ref{fig:diagg3} и~\ref{fig:diagg4} представлены типовые зависимости нелинейности (INL) и погрешности шкалы преобразования (Efs) от температуры и напряжения питания.
Нелинейность определялась как максимальное отклонение измеренного значения выходной частоты ($fo_{real}$) от прямой наилучшего приближения, проведенной через нулевую точку (f0=0, $V_{in}$=0), для положительного и отрицательного входных напряжений. 
$$INL = max |fo_{erri}| = \frac{max |fo_{ideal_{i}} - f0_{real_{i}}|}{2fo_{max}}$$

\begin{figure}[!htb]
\centering
\includegraphics[width=0.8\textwidth]{pics/3.png}
\caption{Зависимости Efs и INL от температуры}
\label{fig:diagg3}
\end{figure}
\FloatBarrier

\begin{figure}[!htb]
\centering
\includegraphics[width=0.8\textwidth]{pics/4.png}
\caption{Зависимости Efs и INL от напряжения питания}
\label{fig:diagg4}
\end{figure}
\FloatBarrier

На рисунках~\ref{fig:diagg5} и~\ref{fig:diagg6} представлены зависимости погрешности шкалы преобразования и нелинейности от входной тактовой частоты (Fclk) для типовых условий (tm models, 25°C, Vdda=3V, Vss=1.8V) и условий, наихудших для нелинейности (wp models, 85°C, Vdda=2.7V, Vss=1.7V). Видно, что при увеличении тактовой частоты с соответствующим уменьшением времени возврата интегратора (Trev), без изменения величины емкости интегратора ведет к линейному увеличению погрешности шкалы, но практически не влияет на нелинейность. Независимость нелинейности от тактовой частоты объясняется тем, что при увеличении тактовой частоты с соответствующим уменьшением времени возврата интегратора, пропорционально Trev уменьшается и амплитуда выходного сигнала интегратора. 
Уменьшение емкости интегратора ведет к увеличению нелинейности, обусловленному увеличением амплитуды выходного сигнала интегратора.

\begin{figure}[!htb]
\centering
\includegraphics[width=0.8\textwidth]{pics/5.png}
\caption{Зависимость Efs от тактовой частоты}
\label{fig:diagg5}
\end{figure}
\FloatBarrier

\begin{figure}[!htb]
\centering
\includegraphics[width=0.8\textwidth]{pics/6.png}
\caption{Зависимость INL от тактовой частоты}
\label{fig:diagg6}
\end{figure}
\FloatBarrier

На рисунке~\ref{fig:diagg7} приведены зависимости относительной погрешности выходной частоты от входного напряжения, показывающие зависимость линейности характеристики преобразования частоты от диапазона входных напряжений (4В, 3В, 2В). Можно видеть, что максимальная нелинейность характеристики преобразования ПНЧ строго пропорциональна диапазону входных напряжений: 
$$INL_{4V} = \frac{4}{3}*INL_{3V}= 2*INL_{2V}$$


\begin{figure}[!htb]
\centering
\includegraphics[width=0.8\textwidth]{pics/7.png}
\caption{Зависимость погрешности выходной частоты от входного напряжения при разном диапазоне}
\label{fig:diagg7}
\end{figure}
\FloatBarrier


Следует отметить, что и нелинейность, и погрешность шкалы преобразования зависят от скоростных параметров усилителя интегратора. Так, увеличение емкости коррекции АЧХ усилителя и увеличение паразитной емкости нагрузки ведут к увеличению нелинейности и погрешности шкалы преобразования.
В нелинейность преобразования вносит вклад и зависимость емкости MiM конденсаторов интегратора от напряжения с коэффициентами VC1=-15 ppm/V, VC2=3.5 ppm/V, однако, ее влияние невелико. Так при типовом преобразовании с входной частотой 8МГц и емкостью интегратора 208 пФ разность амплитуд пульсаций выхода интегратора при нуле и максимальном входном сигнале 4В составляет 0.5В max, то есть вклад нелинейности емкостей в нелинейность преобразования составит всего (0.6*15 – 0.36*3.5)/2 ~ 4 ppm.

На рисунке~\ref{fig:diagg8} приведена эмпирическая зависимость погрешности выходной частоты от входного напряжения вблизи нуля. Эта зависимость построена по зависимости скорости изменения напряжения выхода откалиброванного интегратора с нулевым входным сигналом от величины напряжения выхода, проявляющейся по результатам множества моделирований интегратора в разных условиях. 

Проблема в том, что напряжение выхода интегратора после перехода из режима калибровки в режим преобразования в процессе моделирования устанавливается на не прогнозируемом уровне в диапазоне от Vreft  до Vrefb , в зависимости от условий моделирования. И сама динамическая калибровка смещения в моделировании имеет достаточно большую погрешность, так как последовательное приближение при этой калибровке практически никогда не доходило до конца (прерывание по timeout) из-за ограниченного времени моделирования. Прямое моделирование зависимость погрешности выходной частоты от входного напряжения вблизи нуля также невозможно, так как требует нереально большого времени моделирования.

\begin{figure}[!htb]
\centering
\includegraphics[width=0.8\textwidth]{pics/8.png}
\caption{Зависимость погрешности выходной частоты от входного напряжения}
\label{fig:diagg7}
\end{figure}
\FloatBarrier


Зависимость погрешности выходной частоты от входного напряжения вблизи нуля имеет «мертвую зону» порядка ±1мкВ по входному сигналу, в которой выходная частота будет близка к нулю. Этот эффект обусловлен зависимостью коэффициента усиления выходного каскада усилителя интегратора, не охваченного контуром чоппер-стабилизатора, и как следствие напряжения смещения усилителя, от выходного напряжения. Так, при отклонении выходного напряжения усилителя от точки максимального коэффициента усиления в любую сторону, коэффициент усиления выходного каскада уменьшается и не компенсируемое чоппер-стабилизатором смещение нуля изменяется, компенсируя малые входные сигналы, и стабилизирует выходное напряжение усилителя на некотором уровне в диапазоне Vreft, Vrefb. При этом малое возрастание входного сигнала не приводит к изменению выходного напряжения усилителя и появлению частотных импульсов на выходе ПНЧ до тех пор, пока абсолютная величина входного сигнала не превысит величины напряжения смещения усилителя при выходном сигнале близком к пороговому напряжению компараторов (Vreft, Vrefb). 
Таким образом, «мертвая зона» обусловлена величиной коэффициента усиления выходного каскада реального усилителя и его зависимостью от выходного напряжения. 
Уменьшить напряжение «мертвой зоны» можно двумя путями:

\begin{itemize}
    \item увеличением коэффициента усиления выходного каскада усилителя;
    \item уменьшением пороговых уровней компараторов выхода интегратора (Vreft, Vrefb).
\end{itemize}


\clearpage












\section{Заключение}

Целью данной работы была разработка прецезионного операционного усилителя для интегратора ПНЧ. В разработке использовалось известное техническое решение, минимизирующие смещение нуля - чопперная-стабилизация. Дополнительно предложено введение динамической калибровки для повышения точности ПНЧ. Чопперная-стабилизация уменьшает смещение создаваемое 1 каскадом. Динамическая калибровка уменьшает нелинейность вносимую ключами чоппера, а также выходного каскада. В результате моделирования ОУ были получены его основные характеристики, которые представлены в таблице~\ref{comp}.

\begin{table}[!htb]
\centering
\caption{Полученные характеристики ОУ и сравнение их с ТЗ}
\label{comp}
\begin{tabular}{|l|l|l|}
\hline
Характеристика             & Целевая норма     & Значение по моделированию \\ \hline
Slew rate up {[}В/мкс{]}   & \textgreater 0.15 & 0.196 тип.                \\ \hline
Slew rate down {[}В/мкс{]} & \textgreater 0.15 & 0.196 тип.                \\ \hline
Ku {[}дБ{]}                & \textgreater 100  & 106.4 мин.                \\ \hline
Ku\_200k  {[}дБ{]}         & \textgreater 52   & 53.2 мин.                 \\ \hline
Phase\_m  {[}град.{]}      & \textgreater  60  & 66 мин.                   \\ \hline
F\_3db {[}МГц{]}           & \textgreater 20   & 30  мин.                  \\ \hline
PSRR {[}мкВ/В{]}           &                   & \textless 0.1 тип.        \\ \hline
Vioffs  {[}мкВ{]}          & 5 тип             & 5 тип.                    \\ \hline
\end{tabular}
\end{table}
\FloatBarrier

Моделирование в tran-анализе показало, как калибровка влияет на смещение нуля:

\begin{itemize}
    \item При чоппере скорость дрейфа выходного напряжения интегратора уменьшается в 200 раз
    \item Динамическая калибровка дополнительно уменьшает среднюю скорость дрейфа при активном чоппере в 20 раз
\end{itemize}

Операционный усилитель интегратора в большей мере определяет характеристики ПНЧ, поэтому для подтверждения эффективности разработанного ОУ  было проведено моделирование всего канала ПНЧ. В таблице~\ref{Tab} приведены основные характеристики ПНЧ, полученные при моделировании, а также их целевая норма, заданная в ТЗ.

\begin{table}[!htb]
\centering
\caption{Характеристики ПНЧ полученные после моделирования}
\label{Tab}
\begin{tabular}{|l|l|l|}
\hline
Характеристики                   & Целевая норма    & Значение    \\\hline
Fо0  {[}Гц{]}                    & <0.3             & 0.15 макс.  \\\hline
Нелинейность  {[}\%п.шк.{]}      & <0.01            & 0.005 макс. \\\hline
Погрешность  шкалы {[}\%п.шк.{]} & <0.2             & 0.1 макс.   \\\hline
\end{tabular}
\end{table}
\FloatBarrier


Данные таблицы показывают, что полученные характеристики ОУ интегратора обеспечивают требуемые точностные праметры ПНЧ.





%==========================================================

\cleardoublepage
\begin{thebibliography}{99}
\bibitem{B1} CHONG, C.-Y. and KUMAR, S. P. Sensor networks: Evolution, opportunities, and challenges. Proceedings of the IEEE 91(8), 2003, pp. 1247-1256.
\bibitem{B2} Paul Klonowski, "Analog-to-Digital Conversion Using Voltage-to-Frequency Converters," Application Note AN-276, Analog Devices, Inc. (a good application note on VFCs).
\bibitem{B3} Cristina Azcona Murillo, Belén Calvo Lopez, and Santiago Celma. Pueyo. 2013. Voltage-to-Frequency Converters CMOS Design and Implementation, New York, NY: Springer New York.
\bibitem{B4} P. R. Gray and R. G. Meyer, "MOS operational amplifier design-a tutorial overview," in IEEE Journal of Solid-State Circuits, vol. 17, no. 6, pp. 969-982, Dec. 1982.
doi: 10.1109/JSSC.1982.1051851
\bibitem{B5}Allen, P. E., Douglas R. Holberg, and P. E. Allen. PowerPoint Overheads to Accompany CMOS Analog Circuit Design, 2nd Ed. Oxford: Oxford University Press, 2002.
\bibitem{B6}Graells, Francesc Serra, Huertas Díaz José Luis, and Adoracion Rueda Rueda. VLSI CMOS Subthreshold Log Companding Analog Circuit Techniques for Low-Voltage Applications. 2001.
\bibitem{B7}Аналоговая электроника: [учеб. пособие], Автор:	Анатолий Леонидович Ларин
Издатель: МФТИ, 2007; ISBN:	5741701833, 9785741701836
\bibitem{B8}Behzad Razavi. 2001. Design of analog CMOS integrated circuits, Boston, MA: McGraw-Hill.
\bibitem{B9}Хоровиц П., Хилл У. Искусство схемотехники / В 2-х томах. Пер с англ. М.: «Мир» 1983. — Т.1 590 с. Т.2 — 598 с., илл.
\bibitem{B10}Brumbach, Michael E. Electronic Variable Speed Drives. Albany, NY: Delmar, 2002.
\bibitem{B11}Smithrick, John J., and Ira T. Myers. Effects of Cable and Circuit Parameters on the Precision Calibration of a Charge Amplifier. Washington, D.C.: National Aeronautics and Space Administration, 1968.
\bibitem{B12}Irvine, Robert G. Operational Amplifier Characteristics and Applications. Englewood Cliffs, NJ: Prentice-Hall, 1994.
\bibitem{B13}K. D. Layton, “Low-Voltage Analog CMOS Architectures and Design Methods,” thesis, Phd Thesis, Brigham Young University, Dec. 2007.
\bibitem{B14}A. P. C. Genz, “Operational Amplifier Bandwidth Extension Using Negative Capacitance Generation,” MS thesis, Brigham Young University, August 2006.
\bibitem{B15}P. R. Gray and R. G. Meyer, “Analysis and Design of Analog Integrated Circuits,” 4th edition, John Wiley & Sons, 2001.
\bibitem{B16}H. T. Ng, R. Ziazadeh, and D. Allstot, “A Multistage Amplifier Technique with Embedded Frequency Compensation,” IEEE J. Solid-State Circuits, vol. 34, no. 3, pp. 339–347, Mar. 1999.
\end{thebibliography}

\addcontentsline{toc}{section}{Список литературы}
%=====================================================
\cleardoublepage

\end{document}

